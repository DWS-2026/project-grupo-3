<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Plataforma de pago</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

    <!-- CSS propio -->
    <link rel="stylesheet" href="/web_ejer7/src/main/resources/assets/css/main.css">
    <link rel="stylesheet" href="/web_ejer7/src/main/resources/assets/css/forms-general.css">
    <link rel="stylesheet" href="/web_ejer7/src/main/resources/assets/css/forms-small.css">

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"
            integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
    <script src="/web_ejer7/src/main/resources/assets/js/main.js"></script>
</head>
<body>
<nav id="header-global"></nav>
<main>
  <div class="py-5 text-center">
    <img class="d-block mx-auto mb-4" src="/images/temporal-icon.png " alt="" width="72" height="57">
    <h1 class="h2">Formulario de Pago</h1>
    <p class="lead">Revisa tu carrito y completa los datos para finalizar tu compra.</p>
  </div>

  <div class="row g-5">

    <!-- Carrito -->
    <div class="col-md-5 col-lg-4 order-md-last">
      <h4 class="d-flex justify-content-between align-items-center mb-3">
        <span class="text-primary change-color">Tu carrito</span>
        <span class="badge bg-primary rounded-pill" id="cart-count">0</span>
      </h4>
      <ul class="list-group mb-3" id="cart-items">
        <!-- Items generados por JS -->
      </ul>
      <div class="d-flex justify-content-between align-items-center mb-3">
        <span>Total:</span>
        <strong id="cart-total">€0.00</strong>
      </div>
      <hr class="my-4">
      <a href="carroCompra.html" class="btn eliminar-btn w-100">Volver al carrito</a>
    </div>

    <!-- Formulario de facturación -->
    <div class="col-md-7 col-lg-8">
      <h4 class="mb-3">Dirección de facturación</h4>
      <form id="payment-form" class="needs-validation" novalidate>
        <div class="row g-3">
          <div class="col-sm-6">
            <label for="firstName" class="form-label">Nombre</label>
            <input type="text" class="form-control" id="firstName" placeholder="" required>
            <div class="invalid-feedback">Se requiere un nombre válido.</div>
          </div>
          <div class="col-sm-6">
            <label for="lastName" class="form-label">Apellidos</label>
            <input type="text" class="form-control" id="lastName" placeholder="" required>
            <div class="invalid-feedback">Se requiere un apellido válido.</div>
          </div>
          <div class="col-12">
            <label for="email" class="form-label">Correo electrónico</label>
            <input type="email" class="form-control" id="email" placeholder="tu@correo.com" required>
            <div class="invalid-feedback">Por favor, ingresa un correo válido.</div>
          </div>
          <div class="col-12">
            <label for="address" class="form-label">Dirección</label>
            <input type="text" class="form-control" id="address" placeholder="Calle Principal 123" required>
            <div class="invalid-feedback">Se requiere la dirección.</div>
          </div>
          <div class="col-md-5">
            <label for="country" class="form-label">País</label>
            <select class="form-select" id="country" required>
              <option value="">Selecciona...</option>
              <option>España</option>
            </select>
            <div class="invalid-feedback">Por favor selecciona un país válido.</div>
          </div>
          <div class="col-md-4">
            <label for="state" class="form-label">Provincia</label>
            <select class="form-select" id="state" required>
              <option value="">Selecciona...</option>
              <option>Madrid</option>
              <option>Barcelona</option>
            </select>
            <div class="invalid-feedback">Selecciona una provincia válida.</div>
          </div>
          <div class="col-md-3">
            <label for="zip" class="form-label">Código postal</label>
            <input type="text" class="form-control" id="zip" placeholder="" required>
            <div class="invalid-feedback">Código postal requerido.</div>
          </div>
        </div>

        <hr class="my-4">
        <h4 class="mb-3">Método de pago</h4>
        <div class="my-3">
          <div class="form-check">
            <input id="credit" name="paymentMethod" type="radio" class="form-check-input" checked required>
            <label class="form-check-label" for="credit">Tarjeta de crédito</label>
          </div>
          <div class="form-check">
            <input id="debit" name="paymentMethod" type="radio" class="form-check-input" required>
            <label class="form-check-label" for="debit">Tarjeta de débito</label>
          </div>
          <div class="form-check">
            <input id="paypal" name="paymentMethod" type="radio" class="form-check-input" required>
            <label class="form-check-label" for="paypal">PayPal</label>
          </div>
        </div>

        <div class="row gy-3">
          <div class="col-md-6">
            <label for="cc-name" class="form-label">Nombre en la tarjeta</label>
            <input type="text" class="form-control" id="cc-name" placeholder="" required>
            <small class="text-body-secondary">Nombre completo como aparece en la tarjeta</small>
            <div class="invalid-feedback">Se requiere el nombre en la tarjeta.</div>
          </div>
          <div class="col-md-6">
            <label for="cc-number" class="form-label">Número de tarjeta</label>
            <input type="text" class="form-control" id="cc-number" placeholder="" required>
            <div class="invalid-feedback">Se requiere el número de tarjeta.</div>
          </div>
          <div class="col-md-3">
            <label for="cc-expiration" class="form-label">Expiración</label>
            <input type="text" class="form-control" id="cc-expiration" placeholder="MM/AA" required>
            <div class="invalid-feedback">Se requiere la fecha de expiración.</div>
          </div>
          <div class="col-md-3">
            <label for="cc-cvv" class="form-label">CVV</label>
            <input type="text" class="form-control" id="cc-cvv" placeholder="" required>
            <div class="invalid-feedback">Se requiere el CVV.</div>
          </div>
        </div>
        <hr class="my-4">
        <button class="btn btn-success w-100 main-button" type="submit" href="index.html">Procesar pago</button>

      </form>
    </div>

  </div>
</main>
<script>
  // Obtener carrito desde localStorage
  let carrito = JSON.parse(localStorage.getItem('carrito')) || [];

  const cartItems = document.getElementById('cart-items');
  const cartTotal = document.getElementById('cart-total');
  const cartCount = document.getElementById('cart-count');

  function renderCarritoPago() {
    cartItems.innerHTML = '';
    let total = 0;

    carrito.forEach(item => {
      total += item.precio * item.cantidad;

      const li = document.createElement('li');
      li.classList.add('list-group-item', 'd-flex', 'justify-content-between', 'lh-sm');
      li.innerHTML = `
        <div>
          <h6 class="my-0">${item.nombre}</h6>
          <small class="text-body-secondary">Cantidad: ${item.cantidad}</small>
        </div>
        <span class="text-body-secondary">€${(item.precio * item.cantidad).toFixed(2)}</span>
      `;
      cartItems.appendChild(li);
    });

    cartTotal.innerText = `€${total.toFixed(2)}`;
    cartCount.innerText = carrito.length;
  }

  // Renderizar al cargar la página
  renderCarritoPago();


  const form = document.getElementById('payment-form');

  form.addEventListener('submit', function(event) {
    if (!form.checkValidity()) {
      event.preventDefault(); // bloquea el envío
      form.classList.add('was-validated'); // estilo bootstrap
      return;
    }

    window.location.href = 'index.html'; // redirige al inicio
  });
</script>

<footer id="footer-global"></footer>
</body>
</html>